<!DOCTYPE html>
<%@page import="org.mcgill.ccs2_505.assignment02.inventory.InventoryEntry"%>
<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ page import="org.mcgill.ccs2_505.assignment02.inventory.Inventory" %>
<html>
<head>
	<style>
		table, th, td {
		    border: 1px solid black;
		}
	</style>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
	<title>McGill Book Store Inventory System</title>
</head>
<body>
	<%
		ServletContext context  = request.getServletContext();
		Inventory inventory = (Inventory) context.getAttribute("inventory");
	%>
	<h1>McGill Book Store Inventory System</h1>
	
	<h2>Books</h2>
	<table>
	  <tr>
	  	<th>UID</th>
	  	<th>QTY</th>
	  	<th>Price</th>
	  	<th>Author</th>
	  </tr>	
	  <% if(inventory != null && !inventory.getProductIDs().isEmpty()){ %>
	  		<c:forEach items="${inventory.getProductIDs()}" var="productId" varStatus="status">
	  			<%  InventoryEntry entry = inventory.get("${productId}"); %>
	  			<c:set var="inventoryEntry" value='<%=inventory.get("${productId}")%>'/>
	  			<% if(entry.getProductType().equals("BOOK")) {%>
		  			<c:set var="product" value="${inventoryEntry.product}" />
		  			<tr>
				      <td><c:out value="${product.id}" /></td>
				      <td><c:out value="${inventoryEntry.quantity}" /></td>
				      <td><c:out value="${product.price}" /></td>
				      <td><c:out value="${product.author}" /></td>
				    </tr>
				<%} %> 
	  		</c:forEach>
	  <%} %>
	</table>
	<br>
	<h2>Compact Discs</h2>
	<table>
	  <tr>
	  	<th>UID</th>
	  	<th>QTY</th>
	  	<th>Price</th>
	  	<th>Artist</th>
	  </tr>	
	  <c:choose>
	  	<c:when test="${not empty discsList}">
	  		<c:forEach items="${discsList}" var="discEntry" varStatus="status">
			  	<c:set var="disc" value="${discEntry.product}" />
			    <tr>
			      <td><c:out value="${disc.id}" /></td>
			      <td><c:out value="${discEntry.quantity}" /></td>
			      <td><c:out value="${disc.price}" /></td>
			      <td><c:out value="${disc.artist}" /></td>
			    </tr>
		  </c:forEach>
	  	</c:when>
	  	<c:otherwise>
	  		<tr>
			    <td><c:out value="No discs found"/></td>
			</tr>
	  	</c:otherwise>
	  </c:choose>
	</table>
	<c:if test="${not empty errorMsg}">
  			 <p style="color: #D8000C; font-weight: bold;"><c:out value="${errorMsg}"/></p>
	</c:if>
	<p>Back to the <a href="form.html">form</a>.</p>
</body>
</html>